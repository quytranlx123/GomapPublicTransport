<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Trang Quản Trị</title>
        <!-- Mapbox CSS -->
        <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
        <!-- Mapbox Geocoder CSS -->
        <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.css" />
        <style>
            /* Global Styles */
            body {
                font-family: 'Segoe UI', Arial, sans-serif;
                background: linear-gradient(to bottom, #e6f0fa, #f4f4f9);
                color: #333;
                margin: 0;
                padding: 0;
            }
            .container {
                max-width: 1400px;
                margin: 40px auto;
                padding: 0 20px;
            }
            h1 {
                font-size: 2.5rem;
                color: #1a3c6c;
                text-align: center;
                margin-bottom: 30px;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            }
            h3 {
                font-size: 1.8rem;
                color: #1a3c6c;
                margin-bottom: 20px;
            }

            /* Mapbox */
            #map {
                width: 100%;
                height: 400px;
                border-radius: 12px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                margin-bottom: 30px;
            }

            /* Tabs */
            .nav-tabs {
                display: flex;
                flex-wrap: wrap;
                border-bottom: 2px solid #ddd;
                background: #fff;
                border-radius: 8px 8px 0 0;
                overflow: hidden;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            }
            .nav-tabs .nav-item {
                margin: 0;
            }
            .nav-tabs .nav-link {
                display: block;
                padding: 14px 24px;
                color: #4a5568;
                font-weight: 500;
                text-decoration: none;
                transition: all 0.3s ease;
                border: none;
                background: transparent;
            }
            .nav-tabs .nav-link:hover {
                background: #e2e8f0;
                color: #1a3c6c;
            }
            .nav-tabs .nav-link.active {
                background: #1a3c6c;
                color: #fff;
                border-radius: 6px 6px 0 0;
            }

            /* Tab Content */
            .tab-content {
                background: #fff;
                padding: 30px;
                border-radius: 0 0 8px 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                border: 1px solid #e2e8f0;
                border-top: none;
            }
            .tab-pane {
                display: none;
            }
            .tab-pane.active {
                display: block;
            }

            /* Tables */
            table {
                width: 100%;
                border-collapse: collapse;
                background: #fff;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            }
            th, td {
                padding: 12px 16px;
                text-align: left;
                border-bottom: 1px solid #e2e8f0;
            }
            th {
                background: #f7fafc;
                color: #4a5568;
                font-weight: 600;
                text-transform: uppercase;
                font-size: 0.85rem;
            }
            td {
                color: #2d3748;
                font-size: 0.9rem;
            }
            tr:hover {
                background: #f8fafc;
            }
            .password-ellipsis {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 100px;
            }
            img {
                border-radius: 8px;
            }

            /* Buttons */
            .btn {
                display: inline-block;
                padding: 8px 16px;
                border-radius: 6px;
                font-weight: 500;
                text-align: center;
                text-decoration: none;
                transition: all 0.3s ease;
                cursor: pointer;
                border: none;
            }
            .btn-warning {
                background: #f6ad55;
                color: #fff;
            }
            .btn-warning:hover {
                background: #ed8936;
            }
            .btn-danger {
                background: #e53e3e;
                color: #fff;
            }
            .btn-danger:hover {
                background: #c53030;
            }
            .btn-success {
                background: #38a169;
                color: #fff;
            }
            .btn-success:hover {
                background: #2f855a;
            }

            /* Forms */
            .card {
                background: #fff;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                margin-top: 30px;
            }
            .card-header {
                background: #1a3c6c;
                color: #fff;
                padding: 16px;
                font-size: 1.2rem;
                font-weight: 600;
                border-radius: 8px 8px 0 0;
            }
            .card-body {
                padding: 24px;
            }
            .form-control, .form-select {
                width: 100%;
                padding: 10px;
                border: 1px solid #e2e8f0;
                border-radius: 6px;
                font-size: 0.9rem;
                transition: all 0.3s ease;
            }
            .form-control:focus, .form-select:focus {
                outline: none;
                border-color: #1a3c6c;
                box-shadow: 0 0 0 3px rgba(26, 60, 108, 0.2);
            }
            .form-label {
                font-weight: 500;
                color: #4a5568;
                margin-bottom: 6px;
            }
            textarea.form-control {
                resize: vertical;
            }
            .text-danger {
                color: #e53e3e;
                font-size: 0.85rem;
            }
            .d-none {
                display: none;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .nav-tabs {
                    flex-direction: column;
                }
                .nav-tabs .nav-link {
                    border-radius: 6px;
                    margin: 2px 0;
                }
                .container {
                    padding: 0 15px;
                }
                table {
                    font-size: 0.8rem;
                }
                th, td {
                    padding: 10px;
                }
            }
            .edit-btn, .delete-btn {
                min-width: 90px; /* Fixed minimum width for equal size */
                height: 32px; /* Fixed height for equal size */
                padding: 0 12px; /* Consistent padding */
                line-height: 32px; /* Align text vertically */
                text-align: center; /* Center text and icon */
                display: inline-flex; /* Flex for consistent alignment */
                align-items: center; /* Vertical centering */
                justify-content: center; /* Horizontal centering */
                font-size: 14px; /* Consistent font size */
                transition: all 0.3s ease; /* Smooth hover transition */
                box-sizing: border-box; /* Ensure padding doesn't affect size */
            }

            .edit-btn {
                margin-bottom: 3px;
                background-color: #ffc107; /* Default yellow/gold */
                color: #212529; /* Dark text for contrast */
                border: 1px solid #ffc107;
            }
            .edit-btn:hover {
                background-color: #e0a800; /* Darker yellow on hover */
                border-color: #e0a800;
                color: #212529;
            }

            .delete-btn {
                background-color: #dc3545; /* Default red */
                color: #fff; /* White text for contrast */
                border: 1px solid #dc3545;
            }
            .delete-btn:hover {
                background-color: #b02a37; /* Darker red on hover */
                border-color: #b02a37;
                color: #fff;
            }
            thead th {
                text-align: center;
            }
            table th, table td {
                text-align: center;
                vertical-align: middle;
            }
        </style>
    </head>
    <body>
        <!-- Mapbox -->
        <div id="map"></div>
        <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
        <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.min.js"></script>
        <script>
            mapboxgl.accessToken = 'pk.eyJ1IjoicXV5dHJhbmx4MTIzIiwiYSI6ImNtYTdxYnNsZTBpaXIyam9iNTRzNDN3YWIifQ.zWSkoAn4LPl8DzJL4fLmCw';
            const map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/streets-v11',
                center: [106.660172, 10.762622],
                zoom: 12
            });
            const geocoder = new MapboxGeocoder({
                accessToken: mapboxgl.accessToken,
                mapboxgl: mapboxgl,
                placeholder: 'Nhập địa chỉ điểm đi hoặc điểm đến',
                marker: true,
            });
            map.addControl(geocoder);
            geocoder.on('result', function (e) {
                console.log('Vị trí đã chọn:', e.result);
            });
            fetch('/gomap/api/stations/list')
                    .then(res => res.json())
                    .then(response => {
                        const locations = response.data;
                        locations.forEach(loc => {
                            new mapboxgl.Marker()
                                    .setLngLat([parseFloat(loc.longitude), parseFloat(loc.latitude)])
                                    .setPopup(new mapboxgl.Popup().setText(loc.name))
                                    .addTo(map);
                        });
                    })
                    .catch(error => {
                        console.error("Lỗi khi tải dữ liệu:", error);
                    });
        </script>

        <!-- Main Container -->
        <div class="container">
            <h1>Trang Quản Trị</h1>
            <!-- Tabs -->
            <ul class="nav nav-tabs" id="adminTabs" role="tablist">
                <li class="nav-item"><a class="nav-link active" id="users-tab" href="#users" role="tab">Người dùng</a></li>
                <li class="nav-item"><a class="nav-link" id="routes-tab" href="#routes" role="tab">Tuyến</a></li>
                <li class="nav-item"><a class="nav-link" id="stations-tab" href="#stations" role="tab">Trạm dừng</a></li>
                <li class="nav-item"><a class="nav-link" id="vehicles-tab" href="#vehicles" role="tab">Phương tiện</a></li>
                <li class="nav-item"><a class="nav-link" id="notifications-tab" href="#notifications" role="tab">Thông báo</a></li>
                <li class="nav-item"><a class="nav-link" id="user-notifications-tab" href="#user-notifications" role="tab">Người dùng-Thông báo</a></li>
                <li class="nav-item"><a class="nav-link" id="traffic-reports-tab" href="#traffic-reports" role="tab">Báo cáo giao thông</a></li>
                <li class="nav-item"><a class="nav-link" id="favorite-routes-tab" href="#favorite-routes" role="tab">Tuyến ưa thích</a></li>
                <li class="nav-item"><a class="nav-link" id="schedules-tab" href="#schedules" role="tab">Lịch trình</a></li>
                <li class="nav-item"><a class="nav-link" id="route-stations-tab" href="#route-stations" role="tab">Tuyến-Trạm dừng</a></li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="adminTabContent">
                <!-- Đầu User -->
                <div class="tab-pane active" id="users" role="tabpanel">
                    <h3 class="mb-4 text-primary fw-bold">
                        <i class="bi bi-people-fill"></i> Quản Lý Người Dùng
                    </h3>

                    <div class="table-responsive mb-4">
                        <table class="table table-striped table-bordered table-hover align-middle">
                            <thead class="table-dark text-center">
                                <tr>
                                    <th>ID</th>
                                    <th>Họ Tên</th>
                                    <th>Email</th>
                                    <th>SĐT</th>
                                    <th>Tài khoản</th>
                                    <th>Mật khẩu</th>
                                    <th>Vai trò</th>
                                    <th>Giới tính</th>
                                    <th>Ngày sinh</th>
                                    <th>Avatar</th>
                                    <th>Trạng thái</th>
                                    <th>Ngày tạo</th>
                                    <th>Hành động</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody" class="text-center">
                                <tr th:each="user : ${users}">
                                    <td th:text="${user.id}"></td>
                                    <td th:text="${user.fullName}"></td>
                                    <td th:text="${user.email}"></td>
                                    <td th:text="${user.phone}"></td>
                                    <td th:text="${user.username}"></td>
                                    <td class="password-ellipsis" 
                                        th:text="${#strings.length(user.password) > 10 ? #strings.substring(user.password, 0, 7) + '...' : user.password}">
                                    </td>
                                    <td th:text="${user.userRole}"></td>
                                    <td th:text="${user.gender}"></td>
                                    <td th:text="${#dates.format(user.birthday, 'yyyy-MM-dd')}"></td>
                                    <td>
                                        <img th:src="${user.avatar}" alt="Avatar" style="width:50px; height:50px;" class="rounded-circle border">
                                    </td>
                                    <td th:text="${user.isActive ? 'Đang hoạt động' : 'Tạm dừng'}"></td>
                                    <td th:text="${#dates.format(user.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
                                    <td class="text-center">
                                        <div class="d-flex justify-content-center gap-3">
                                            <button type="button" class="btn btn-sm rounded-pill edit-btn"
                                                    onclick="return confirm('Bạn có chắc chắn muốn chỉnh sửa thông tin người dùng này?')"
                                                    th:attr="data-id=${user.id}" title="Sửa người dùng">
                                                <i class="bi bi-pencil-square me-1"></i> Sửa
                                            </button>
                                            <button type="button" class="btn btn-sm rounded-pill delete-btn"
                                                    onclick="return confirm('Bạn có chắc chắn muốn xóa người dùng này?')"
                                                    th:attr="data-id=${user.id}" title="Xóa người dùng">
                                                <i class="bi bi-trash me-1"></i> Xóa
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="card shadow rounded">
                        <div class="card-header bg-success text-white fw-bold">
                            <i class="bi bi-person-plus-fill"></i> Thêm Người Dùng
                        </div>
                        <div class="card-body">
                            <form id="addUserForm" th:action="@{/admin/dashboard/users/save}" method="post" enctype="multipart/form-data">
                                <div class="row g-3">
                                    <div class="col-md-6 mb-3">
                                        <input type="text" class="form-control" name="fullName" placeholder="Họ và tên" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <input type="email" class="form-control" name="email" placeholder="Email" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <input type="text" class="form-control" name="phone" placeholder="Số điện thoại" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <input type="text" class="form-control" name="username" placeholder="Tên tài khoản" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <input type="password" class="form-control" name="password" placeholder="Mật khẩu" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <select class="form-control" name="userRole" required>
                                            <option value="">-- Chọn vai trò --</option>
                                            <option value="ADMIN">Admin</option>
                                            <option value="USER">User</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <select class="form-control" name="gender" required>
                                            <option value="">-- Chọn giới tính --</option>
                                            <option value="MALE">Nam</option>
                                            <option value="FEMALE">Nữ</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <input type="date" class="form-control" name="birthday" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <input type="file" class="form-control" name="avatar" accept="image/*">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <select class="form-control" name="isActive" required>
                                            <option value="">-- Chọn trạng thái hoạt động --</option>
                                            <option value="true">Đang hoạt động</option>
                                            <option value="false">Tạm dừng</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mt-3 text-end">
                                    <button type="submit" class="btn btn-success">
                                        <i class="bi bi-plus-circle"></i> Thêm người dùng
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Đầu Route -->
                <div class="tab-pane" id="routes" role="tabpanel">
                    <h3>Quản Lý Tuyến</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tên tuyến</th>
                                <th>Điểm bắt đầu</th>
                                <th>Điểm kết thúc</th>
                                <th>Trạng thái</th>
                                <th>Tần suất</th>
                                <th>Thời gian bắt đầu</th>
                                <th>Thời gian kết thúc</th>
                                <th>Khoảng cách (km)</th>
                                <th>Thời lượng (phút)</th>
                                <th>Ngày tạo</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="routeTableBody">
                            <tr th:each="route : ${routes}">
                                <td th:text="${route.id}"></td>
                                <td th:text="${route.name}"></td>
                                <td th:text="${route.startPoint}"></td>
                                <td th:text="${route.endPoint}"></td>
                                <td th:text="${route.status}"></td>
                                <td th:text="${route.frequency}"></td>
                                <td th:text="${#dates.format(route.startTime, 'HH:mm')}"></td>
                                <td th:text="${#dates.format(route.endTime, 'HH:mm')}"></td>
                                <td th:text="${route.distance}"></td>
                                <td th:text="${route.duration}"></td>
                                <td th:text="${#dates.format(route.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
                                <td class="text-center">
                                    <div class="d-flex justify-content-center gap-3">
                                        <button type="button" class="btn btn-sm rounded-pill edit-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn chỉnh sửa tuyến này?')"
                                                th:attr="data-id=${route.id}" title="Sửa tuyến">
                                            <i class="bi bi-pencil-square me-1"></i> Sửa
                                        </button>
                                        <button type="button" class="btn btn-sm rounded-pill delete-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn xóa tuyến này?')"
                                                th:attr="data-id=${route.id}" title="Xóa tuyến">
                                            <i class="bi bi-trash me-1"></i> Xóa
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="card">
                        <div class="card-header">Thêm Tuyến</div>
                        <div class="card-body">
                            <form id="addRouteForm" th:action="@{/admin/dashboard/routes/save}" method="post" onsubmit="return validateForm()">
                                <div class="row g-3">
                                    <div class="col-md-6 d-flex align-items-center">
                                        <input type="hidden" name="name" id="routName">
                                        <label class="me-2 mb-0" style="white-space: nowrap;">Tuyến số</label>
                                        <input type="number" class="form-control" name="routeNumber" id="routeNumber" placeholder="Nhập số..." min="1" required>
                                    </div>
                                    <div class="col-md-6">
                                        <select class="form-select" name="startPoint" id="startPoint" required>
                                            <option value="">-- Chọn điểm bắt đầu --</option>
                                            <option th:each="station : ${stations}" th:value="${station.name}" th:text="${station.name}"></option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <select class="form-select" name="endPoint" id="endPoint" required>
                                            <option value="">-- Chọn điểm kết thúc --</option>
                                            <option th:each="station : ${stations}" th:value="${station.name}" th:text="${station.name}"></option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <select class="form-select" name="status" required>
                                            <option value="active">Active</option>
                                            <option value="inactive">Inactive</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="number" class="form-control" name="frequency" placeholder="Frequency (minutes)" min="1" required>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="time" class="form-control" name="startTime" required>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="time" class="form-control" name="endTime" required>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="distance" name="distance" placeholder="Khoảng cách (Km)" required>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="number" class="form-control" id="duration" name="duration" placeholder="Thời gian di chuyển (phút)" min="1" required>
                                    </div>
                                </div>
                                <div class="mt-3 text-end">
                                    <button type="submit" class="btn btn-success">Thêm Tuyến</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!--Cuối Route-->

                <!--Đầu Station-->
                <div class="tab-pane" id="stations" role="tabpanel">
                    <h3>Quản Lý Trạm Dừng</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tên trạm</th>
                                <th>Vĩ độ</th>
                                <th>Kinh độ</th>
                                <th>Địa chỉ</th>
                                <th>Ngày tạo</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="stationTableBody">
                            <tr th:each="station : ${stations}">
                                <td th:text="${station.id}"></td>
                                <td th:text="${station.name}"></td>
                                <td th:text="${station.latitude}"></td>
                                <td th:text="${station.longitude}"></td>
                                <td th:text="${station.address}"></td>
                                <td th:text="${#dates.format(station.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
                                <td class="text-center">
                                    <div class="d-flex justify-content-center gap-3">
                                        <button type="button" class="btn btn-sm rounded-pill edit-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn chỉnh sửa thông tin trạm này?')"
                                                th:attr="data-id=${station.id}" title="Sửa trạm">
                                            <i class="bi bi-pencil-square me-1"></i> Sửa
                                        </button>
                                        <button type="button" class="btn btn-sm rounded-pill delete-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn xóa trạm này?')"
                                                th:attr="data-id=${station.id}" title="Xóa trạm">
                                            <i class="bi bi-trash me-1"></i> Xóa
                                        </button>
                                    </div>
                                </td>

                            </tr>
                        </tbody>
                    </table>
                    <div class="card">
                        <div class="card-header">Thêm Trạm Dừng</div>
                        <div class="card-body">
                            <form id="addStationForm" th:action="@{/admin/dashboard/stations/save}" method="post">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" name="name" placeholder="Station Name" required>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" name="address" placeholder="Address">
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" name="latitude" id="latitude" placeholder="Latitude" required>
                                        <small id="latitude-error" class="text-danger d-none">Latitude phải là số thực trong khoảng [-90; 90]</small>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" name="longitude" id="longitude" placeholder="Longitude" required>
                                        <small id="longitude-error" class="text-danger d-none">Longitude phải là số thực trong khoảng [-180; 180]</small>
                                    </div>
                                </div>
                                <div class="mt-3 text-end">
                                    <button type="submit" class="btn btn-success">Add Station</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!--Đầu Vehicle-->
                <div class="tab-pane" id="vehicles" role="tabpanel">
                    <h3>Quản Lý Phương Tiện</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Bảng số</th>
                                <th>Loại</th>
                                <th>Tài xế</th>
                                <th>Sức chứa</th>
                                <th>Vĩ độ</th>
                                <th>Kinh độ</th>
                                <th>Trạng thái</th>
                                <th>Cập nhật lúc</th>
                                <th>Ngày tạo</th>
                                <th>Tuyến ID</th>
                                <th>Trạng thái</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="vehicleTableBody">
                            <tr th:each="vehicle : ${vehicles}">
                                <td th:text="${vehicle.id}"></td>
                                <td th:text="${vehicle.licensePlate}"></td>
                                <td th:text="${vehicle.vehicleType}"></td>
                                <td th:text="${vehicle.driver}"></td>
                                <td th:text="${vehicle.capacity}"></td>
                                <td th:text="${vehicle.latitude}"></td>
                                <td th:text="${vehicle.longitude}"></td>
                                <td th:text="${vehicle.status}"></td>
                                <td th:text="${#dates.format(vehicle.updatedAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
                                <td th:text="${#dates.format(vehicle.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
                                <td th:text="${vehicle.routeId != null ? vehicle.routeId.id : 'N/A'}"></td>
                                <td th:text="${vehicle.isActive ? 'Đang hoạt động' : 'Không hoạt động'}"></td>
                                <td class="text-center">
                                    <div class="d-flex justify-content-center gap-3">
                                        <button type="button" class="btn btn-sm rounded-pill edit-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn chỉnh sửa thông tin phương tiện này?')"
                                                th:attr="data-id=${vehicle.id}" title="Sửa phương tiện">
                                            <i class="bi bi-pencil-square me-1"></i> Sửa
                                        </button>
                                        <button type="button" class="btn btn-sm rounded-pill delete-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn xóa phương tiện này?')"
                                                th:attr="data-id=${vehicle.id}" title="Xóa phương tiện">
                                            <i class="bi bi-trash me-1"></i> Xóa
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="card">
                        <div class="card-header">Thêm Phương Tiện</div>
                        <div class="card-body">
                            <form id="addVehicleForm" th:action="@{/admin/dashboard/vehicles/save}" method="post">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" name="licensePlate" placeholder="License Plate" required>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" name="vehicleType" placeholder="Vehicle Type" required>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" name="driver" placeholder="Driver Name" required>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="number" class="form-control" name="capacity" placeholder="Capacity" required>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="number" step="0.000001" class="form-control" name="latitude" placeholder="Latitude" required>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="number" step="0.000001" class="form-control" name="longitude" placeholder="Longitude" required>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" name="status" placeholder="Status" required>
                                    </div>
                                    <div class="col-md-6">
                                        <select class="form-control" name="isActive" required>
                                            <option value="">-- Select Active Status --</option>
                                            <option value="true">Active</option>
                                            <option value="false">Inactive</option>
                                        </select>
                                    </div>
                                    <div class="col-md-12">
                                        <label for="routeId" class="form-label">Route</label>
                                        <select class="form-control" name="routeId" required>
                                            <option value="">-- Select Route --</option>
                                            <option th:each="route : ${routes}" th:value="${route.id}" th:text="${route.name}"></option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mt-3 text-end">
                                    <button type="submit" class="btn btn-success">Add Vehicle</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Notifications Tab -->
                <div class="tab-pane" id="notifications" role="tabpanel">
                    <h3>Quản Lý Thông Báo</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Mã số</th>
                                <th>Sự kiện</th>
                                <th>Nội dung</th>
                                <th>Loại thông báo</th>
                                <th>Ngày tạo</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="notificationTableBody">
                            <tr th:each="notification : ${notifications}">
                                <td th:text="${notification.id}"></td>
                                <td th:text="${notification.title}"></td>
                                <td th:text="${notification.message}"></td>
                                <td th:text="${notification.messageType}"></td>
                                <td th:text="${#dates.format(notification.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
                                <td class="text-center">
                                    <div class="d-flex justify-content-center gap-3">
                                        <button type="button" class="btn btn-sm rounded-pill edit-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn chỉnh sửa thông báo này?')"
                                                th:attr="data-id=${notification.id}" title="Sửa thông báo">
                                            <i class="bi bi-pencil-square me-1"></i> Sửa
                                        </button>
                                        <button type="button" class="btn btn-sm rounded-pill delete-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn xóa thông báo này?')"
                                                th:attr="data-id=${notification.id}" title="Xóa thông báo">
                                            <i class="bi bi-trash me-1"></i> Xóa
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="card">
                        <div class="card-header">Thêm Thông Báo Mới</div>
                        <div class="card-body">
                            <form id="addNotificationForm" th:action="@{/admin/dashboard/notifications/save}" method="post">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" name="title" placeholder="Tiêu đề" required>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" name="messageType" placeholder="Loại thông báo" required>
                                    </div>
                                    <div class="col-md-12">
                                        <textarea class="form-control" name="message" rows="4" placeholder="Nội dung thông báo" required></textarea>
                                    </div>
                                </div>
                                <div class="mt-3 text-end">
                                    <button type="submit" class="btn btn-success">Thêm Thông Báo</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- User Notifications Tab -->
                <div class="tab-pane" id="user-notifications" role="tabpanel">
                    <h3>Bảng Người dùng - Thông báo</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Thời gian gửi</th>
                                <th>Đã đọc</th>
                                <th>ID Thông báo</th>
                                <th>ID Người dùng</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="userNotificationTableBody">
                            <tr th:each="un : ${userNotifications}">
                                <td th:text="${un.id}"></td>
                                <td th:text="${#dates.format(un.sendAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
                                <td th:text="${un.isRead} ? 'Read' : 'Unread'"></td>
                                <td th:text="${un.notificationId.id}"></td>
                                <td th:text="${un.userId != null ? un.userId.id : 'N/A'}"></td>
                                <td class="text-center">
                                    <div class="d-flex justify-content-center gap-3">
                                        <button type="button" class="btn btn-sm rounded-pill edit-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn chỉnh sửa thông báo người dùng này?')"
                                                th:attr="data-id=${un.id}" title="Sửa thông báo người dùng">
                                            <i class="bi bi-pencil-square me-1"></i> Sửa
                                        </button>
                                        <button type="button" class="btn btn-sm rounded-pill delete-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn xóa thông báo người dùng này?')"
                                                th:attr="data-id=${un.id}" title="Xóa thông báo người dùng">
                                            <i class="bi bi-trash me-1"></i> Xóa
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="card">
                        <div class="card-header">Thêm Thông Báo Đến Người Dùng</div>
                        <div class="card-body">
                            <form id="addUserNotificationForm" th:action="@{/admin/user-notifications/save}" method="post">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="sendAt" class="form-label">Send At</label>
                                        <input type="datetime-local" class="form-control" name="sendAt" id="sendAt" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="isRead" class="form-label">Is Read</label>
                                        <select class="form-select" name="isRead" id="isRead" required>
                                            <option value="true">Read</option>
                                            <option value="false" selected>Unread</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="notificationId" class="form-label">Notification ID</label>
                                        <input type="number" class="form-control" name="notificationId" id="notificationId" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="userId" class="form-label">User ID (Optional)</label>
                                        <input type="number" class="form-control" name="userId" id="userId">
                                    </div>
                                </div>
                                <div class="mt-3 text-end">
                                    <button type="submit" class="btn btn-success">Add Notification</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Traffic Reports Tab -->
                <div class="tab-pane" id="traffic-reports" role="tabpanel">
                    <h3>Quản Lý Báo Cáo Giao Thông</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Mã số</th>
                                <th>Tiêu đề</th>
                                <th>Địa điểm</th>
                                <th>Vĩ độ</th>
                                <th>Kinh độ</th>
                                <th>Hình ảnh</th>
                                <th>Mô tả chi tiết</th>
                                <th>Ngày tạo</th>
                                <th>Đã xác thực</th>
                                <th>Mã người dùng</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="trafficReportTableBody">
                            <tr th:each="tr : ${trafficReports}">
                                <td th:text="${tr.id}"></td>
                                <td th:text="${tr.title}"></td>
                                <td th:text="${tr.address}"></td>
                                <td th:text="${tr.latitude}"></td>
                                <td th:text="${tr.longitude}"></td>
                                <td>
                                    <img th:src="@{${tr.image}}" alt="Hình ảnh giao thông" width="80" height="60">
                                </td>
                                <td th:text="${tr.description}"></td>
                                <td th:text="${#dates.format(tr.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
                                <td th:text="${tr.isVerified} ? 'Đã xác thực' : 'Chưa xác thực'"></td>
                                <td th:text="${tr.userId != null ? tr.userId.id : 'Không có'}"></td>
                                <td class="text-center">
                                    <div class="d-flex justify-content-center gap-3">
                                        <button type="button" class="btn btn-sm rounded-pill edit-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn chỉnh sửa báo cáo giao thông này?')"
                                                th:attr="data-id=${tr.id}" title="Sửa báo cáo giao thông">
                                            <i class="bi bi-pencil-square me-1"></i> Sửa
                                        </button>
                                        <button type="button" class="btn btn-sm rounded-pill delete-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn xóa báo cáo giao thông này?')"
                                                th:attr="data-id=${tr.id}" title="Xóa báo cáo giao thông">
                                            <i class="bi bi-trash me-1"></i> Xóa
                                        </button>
                                    </div>
                                </td>

                            </tr>
                        </tbody>
                    </table>
                    <div class="card">
                        <div class="card-header">Thêm Báo Cáo Giao Thông Mới</div>
                        <div class="card-body">
                            <form id="addTrafficReportForm" th:action="@{/admin/traffic-reports/save}" method="post" enctype="multipart/form-data">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="title" class="form-label">Tiêu đề</label>
                                        <input type="text" class="form-control" name="title" id="title" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="address" class="form-label">Địa chỉ</label>
                                        <input type="text" class="form-control" name="address" id="address" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="latitude" class="form-label">Vĩ độ</label>
                                        <input type="number" step="0.000001" class="form-control" name="latitude" id="latitude" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="longitude" class="form-label">Kinh độ</label>
                                        <input type="number" step="0.000001" class="form-control" name="longitude" id="longitude" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="imageFile" class="form-label">Tải lên hình ảnh</label>
                                        <input type="file" class="form-control" name="imageFile" id="imageFile" accept="image/*">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="description" class="form-label">Mô tả</label>
                                        <input type="text" class="form-control" name="description" id="description">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="isVerified" class="form-label">Đã xác thực</label>
                                        <select class="form-select" name="isVerified" id="isVerified" required>
                                            <option value="true">Đã xác thực</option>
                                            <option value="false" selected>Chưa xác thực</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="userId" class="form-label">Mã người dùng (Tùy chọn)</label>
                                        <input type="number" class="form-control" name="userId" id="userId">
                                    </div>
                                </div>
                                <div class="mt-3 text-end">
                                    <button type="submit" class="btn btn-success">Thêm Báo Cáo Giao Thông</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Favorite Routes Tab -->
                <div class="tab-pane" id="favorite-routes" role="tabpanel">
                    <h3>Quản Lý Tuyến Ưa Thích</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ID Tuyến</th>
                                <th>ID Người dùng</th>
                                <th>Ngày tạo</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="favoriteRouteTableBody">
                            <tr th:each="fr : ${favoriteRoutes}">
                                <td th:text="${fr.id}"></td>
                                <td th:text="${fr.routeId.id}"></td>
                                <td th:text="${fr.userId != null ? fr.userId.id : 'N/A'}"></td>
                                <td th:text="${#dates.format(fr.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
                                <td class="text-center">
                                    <div class="d-flex justify-content-center gap-3">
                                        <button type="button" class="btn btn-sm rounded-pill edit-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn chỉnh sửa tuyến yêu thích này?')"
                                                th:attr="data-id=${fr.id}" title="Sửa tuyến yêu thích">
                                            <i class="bi bi-pencil-square me-1"></i> Sửa
                                        </button>
                                        <button type="button" class="btn btn-sm rounded-pill delete-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn xóa tuyến yêu thích này?')"
                                                th:attr="data-id=${fr.id}" title="Xóa tuyến yêu thích">
                                            <i class="bi bi-trash me-1"></i> Xóa
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="card">
                        <div class="card-header">Add New Favorite Route</div>
                        <div class="card-body">
                            <form id="addFavoriteRouteForm" th:action="@{/admin/favorite-routes/save}" method="post">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="routeId" class="form-label">Route</label>
                                        <select class="form-select" name="routeId" id="routeId" required>
                                            <option th:each="route : ${routes}" th:value="${route.id}" th:text="${route.name}"></option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="userId" class="form-label">User ID</label>
                                        <input type="number" class="form-control" name="userId" id="userId">
                                    </div>
                                </div>
                                <div class="mt-3 text-end">
                                    <button type="submit" class="btn btn-success">Add Favorite Route</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Schedules Tab -->
                <div class="tab-pane" id="schedules" role="tabpanel">
                    <h3>Quản Lý Lịch Trình</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Giờ Khởi Hành</th>
                                <th>Giờ Đến</th>
                                <th>Phương Tiện</th>
                                <th>Hành Động</th>
                            </tr>
                        </thead>
                        <tbody id="scheduleTableBody">
                            <tr th:each="s : ${schedules}">
                                <td th:text="${s.id}"></td>
                                <td th:text="${#dates.format(s.departureTime, 'HH:mm:ss')}"></td>
                                <td th:text="${#dates.format(s.arrivalTime, 'HH:mm:ss')}"></td>
                                <td th:text="${s.vehicleId != null ? s.vehicleId.licensePlate : 'N/A'}"></td>
                                <td class="text-center">
                                    <div class="d-flex justify-content-center gap-3">
                                        <button type="button" class="btn btn-sm rounded-pill edit-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn chỉnh sửa lịch trình này?')"
                                                th:attr="data-id=${s.id}" title="Sửa lịch trình">
                                            <i class="bi bi-pencil-square me-1"></i> Sửa
                                        </button>
                                        <button type="button" class="btn btn-sm rounded-pill delete-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn xóa lịch trình này?')"
                                                th:attr="data-id=${s.id}" title="Xóa lịch trình">
                                            <i class="bi bi-trash me-1"></i> Xóa
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="card">
                        <div class="card-header">Thêm Lịch Trình Mới</div>
                        <div class="card-body">
                            <form id="addScheduleForm" th:action="@{/admin/schedules/save}" method="post">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="departureTime" class="form-label">Giờ Khởi Hành</label>
                                        <input type="time" class="form-control" name="departureTime" id="departureTime" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="arrivalTime" class="form-label">Giờ Đến</label>
                                        <input type="time" class="form-control" name="arrivalTime" id="arrivalTime" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="vehicleId" class="form-label">Phương Tiện</label>
                                        <select class="form-select" name="vehicleId" id="vehicleId" required>
                                            <option th:each="vehicle : ${vehicles}" th:value="${vehicle.id}" th:text="${vehicle.licensePlate}"></option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mt-3 text-end">
                                    <button type="submit" class="btn btn-success">Thêm Lịch Trình</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Route Stations Tab -->
                <div class="tab-pane" id="route-stations" role="tabpanel">
                    <h3>Quản Lý Tuyến - Trạm Dừng (Điểm Dừng)</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Thứ Tự Trạm</th>
                                <th>Khoảng Cách</th>
                                <th>Thời Gian</th>
                                <th>ID Tuyến Đường</th>
                                <th>ID Trạm</th>
                                <th>Hành Động</th>
                            </tr>
                        </thead>
                        <tbody id="routeStationTableBody">
                            <tr th:each="rs : ${routeStations}">
                                <td th:text="${rs.id}"></td>
                                <td th:text="${rs.orderStation}"></td>
                                <td th:text="${rs.distance}"></td>
                                <td th:text="${rs.duration}"></td>
                                <td th:text="${rs.routeId != null ? rs.routeId.id : 'N/A'}"></td>
                                <td th:text="${rs.stationId != null ? rs.stationId.id : 'N/A'}"></td>
                                <td class="text-center">
                                    <div class="d-flex justify-content-center gap-3">
                                        <button type="button" class="btn btn-sm rounded-pill edit-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn chỉnh sửa trạm tuyến này?')"
                                                th:attr="data-id=${rs.id}" title="Sửa trạm tuyến">
                                            <i class="bi bi-pencil-square me-1"></i> Sửa
                                        </button>
                                        <button type="button" class="btn btn-sm rounded-pill delete-btn"
                                                onclick="return confirm('Bạn có chắc chắn muốn xóa trạm tuyến này?')"
                                                th:attr="data-id=${rs.id}" title="Xóa trạm tuyến">
                                            <i class="bi bi-trash me-1"></i> Xóa
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="card">
                        <div class="card-header">Thêm Trạm Tuyến Đường Mới</div>
                        <div class="card-body">
                            <form id="addRouteStationForm" th:action="@{/admin/route-stations/save}" method="post">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="orderStation" class="form-label">Thứ Tự</label>
                                        <input type="number" class="form-control" name="orderStation" id="orderStation" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="distance" class="form-label">Khoảng Cách (km)</label>
                                        <input type="number" step="0.1" class="form-control" name="distance" id="distance" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="duration" class="form-label">Thời Gian (phút)</label>
                                        <input type="number" class="form-control" name="duration" id="duration" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="routeId" class="form-label">Tuyến Đường</label>
                                        <select class="form-select" name="routeId" id="routeId" required>
                                            <option th:each="route : ${routes}" th:value="${route.id}" th:text="${route.name}"></option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="stationId" class="form-label">Trạm</label>
                                        <select class="form-select" name="stationId" id="stationId" required>
                                            <option th:each="station : ${stations}" th:value="${station.id}" th:text="${station.name}"></option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mt-3 text-end">
                                    <button type="submit" class="btn btn-success">Thêm Trạm Tuyến Đường</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- JavaScript -->
        <script>
            // User Delete Confirmation
            function confirmDelete(userId) {
                if (confirm("Bạn có chắc chắn muốn xóa người dùng này không?")) {
                    fetch(`/gomap/admin/dashboard/users/delete/${userId}`, {
                        method: 'POST'
                    })
                            .then(response => {
                                if (!response.ok)
                                    throw new Error('Xóa không thành công');
                                const tableBody = document.getElementById('userTableBody');
                                const rows = tableBody.querySelectorAll('tr');
                                rows.forEach(row => {
                                    if (row.querySelector('td')?.textContent == userId) {
                                        row.remove();
                                    }
                                });
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('Không thể xóa người dùng.');
                            });
                }
            }

            // Route Validation
            const startPoint = document.getElementById('startPoint');
            const endPoint = document.getElementById('endPoint');
            function validateDifferent() {
                if (startPoint.value && endPoint.value && startPoint.value === endPoint.value) {
                    alert("Điểm bắt đầu và điểm kết thúc không được trùng nhau.");
                    this.value = '';
                }
            }
            startPoint.addEventListener('change', validateDifferent);
            endPoint.addEventListener('change', validateDifferent);
            document.addEventListener("DOMContentLoaded", function () {
                const routeNumberInput = document.getElementById("routeNumber");
                const routeNameInput = document.getElementById("routName");
                routeNumberInput.addEventListener("input", function () {
                    const number = routeNumberInput.value;
                    routeNameInput.value = number ? `Tuyến số ${number}` : "";
                });
            });

            // Station Validation
            function isValidDouble(value) {
                const cleaned = value.replace(",", ".");
                const num = parseFloat(cleaned);
                return !isNaN(num) && isFinite(num);
            }
            function parseToFloat(value) {
                return parseFloat(value.replace(",", "."));
            }
            const latitudeInput = document.getElementById("latitude");
            const latitudeError = document.getElementById("latitude-error");
            const longitudeInput = document.getElementById("longitude");
            const longitudeError = document.getElementById("longitude-error");
            function normalizeInput(input) {
                input.addEventListener("input", () => {
                    if (input.value.includes(",")) {
                        input.value = input.value.replace(",", ".");
                    }
                    const value = input.value.trim();
                    const num = parseToFloat(value);
                    if (input === latitudeInput) {
                        if (!isValidDouble(value) || num < -90 || num > 90) {
                            latitudeError.classList.remove("d-none");
                        } else {
                            latitudeError.classList.add("d-none");
                        }
                    }
                    if (input === longitudeInput) {
                        if (!isValidDouble(value) || num < -180 || num > 180) {
                            longitudeError.classList.remove("d-none");
                        } else {
                            longitudeError.classList.add("d-none");
                        }
                    }
                });
            }
            normalizeInput(latitudeInput);
            normalizeInput(longitudeInput);

            // Custom Tab Navigation
            document.querySelectorAll('.nav-tabs .nav-link').forEach(tab => {
                tab.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelectorAll('.nav-tabs .nav-link').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelectorAll('.tab-pane').forEach(content => content.classList.remove('active'));
                    const target = document.querySelector(this.getAttribute('href'));
                    target.classList.add('active');
                });
            });
        </script>
    </body>
</html>